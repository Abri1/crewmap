# Deploy Crew Map to Railway - One Click Setup

This guide shows you how to deploy the ENTIRE Crew Map application (web app + GPS tracking server + database) to Railway with just one GitHub repository.

## What Gets Deployed

Railway will automatically deploy **3 services** from this single repository:

1. **Web App** - Your Crew Map React application
2. **Traccar Server** - GPS tracking server for mobile apps
3. **PostgreSQL** - Database for Traccar

Everything runs together in one Railway project!

## Prerequisites

You need 3 things before deploying:

1. **Supabase Project** - Get your URL and anon key from [supabase.com](https://supabase.com)
2. **Mapbox Token** - Get your access token from [mapbox.com](https://mapbox.com)
3. **GitHub Account** - To connect your repository

## Deployment Steps

### Step 1: Fork or Push to GitHub

Make sure this repository is on GitHub under your account.

### Step 2: Deploy to Railway

1. Go to [railway.app](https://railway.app) and sign in
2. Click **"New Project"**
3. Select **"Deploy from GitHub repo"**
4. Choose your `crewmap` repository
5. Railway will detect the `railway.json` file and set up all 3 services automatically

### Step 3: Add Environment Variables

Railway will prompt you for these variables:

- **SUPABASE_URL**: Your Supabase project URL (example: `https://xxxxx.supabase.co`)
- **SUPABASE_ANON_KEY**: Your Supabase anonymous key (long string starting with `eyJ...`)
- **MAPBOX_TOKEN**: Your Mapbox access token (starts with `pk.`)
- **DATABASE_PASSWORD**: Auto-generated by Railway (leave as is)

Click **Deploy** when done!

### Step 4: Get Your URLs

After deployment (takes 2-3 minutes), you'll have:

1. **Web App URL**: Click on the "web" service → Settings → Public Domain
   - Example: `crewmap-production.up.railway.app`
   - This is your main Crew Map app!

2. **Traccar Server URL**: Click on the "traccar" service → Settings → Public Domain
   - Example: `traccar-production.up.railway.app`
   - This is for GPS tracking apps to connect to

## Configure Mobile GPS Tracking

### Download Traccar Client App

- **iOS**: [App Store - Traccar Client](https://apps.apple.com/us/app/traccar-client/id843156974)
- **Android**: [Google Play - Traccar Client](https://play.google.com/store/apps/details?id=org.traccar.client)

### Setup in App

1. Open Traccar Client app
2. Enter these settings:
   - **Server URL**: Your Traccar URL with port (example: `https://traccar-production.up.railway.app:5055`)
   - **Device Identifier**: Your driver ID from Crew Map (shown after joining crew)
   - **Frequency**: 30 seconds recommended
3. Enable **"Service status"** toggle
4. Grant location permissions to app

That's it! Your GPS location will now show on the Crew Map in real-time.

## Default Traccar Admin Login

If you need to access the Traccar web interface:

- URL: Your Traccar URL on port 8082 (example: `https://traccar-production.up.railway.app:8082`)
- Email: `admin`
- Password: `admin`

**Important**: Change this password after first login!

## Cost

Railway offers:

- **Free Tier**: $5/month in credits (enough for small crews)
- **Paid Plans**: Starting at $5/month for more usage

Your deployment should fit within the free tier for testing and small teams.

## Troubleshooting

### Web app not loading
- Check that all environment variables are set correctly
- View logs in Railway dashboard under "web" service

### GPS not updating
- Verify Traccar service is running (check Railway logs)
- Confirm device identifier matches your driver ID
- Check that location permissions are granted in mobile app

### Database issues
- PostgreSQL service should start automatically
- If Traccar can't connect, check DATABASE_PASSWORD variable

## Support

For issues with:
- **Railway deployment**: [Railway Docs](https://docs.railway.app)
- **Traccar GPS**: [Traccar Documentation](https://www.traccar.org/documentation/)
- **This app**: Open an issue on GitHub
